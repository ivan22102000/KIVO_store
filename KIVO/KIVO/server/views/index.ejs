<% 
// Set page context for navigation
let page = 'home';
let description = 'Tienda minimalista con arquitectura MVC, Supabase Auth y dashboard administrativo interactivo para estudiantes';
%>

<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1 class="hero-title" data-testid="text-hero-title">
                        Tienda <span style="color: var(--primary-color);">Minimalista</span>
                        <br>para Estudiantes
                    </h1>
                    <p class="hero-subtitle" data-testid="text-hero-subtitle">
                        Plataforma educativa de e-commerce con arquitectura MVC, 
                        Supabase Auth y dashboard administrativo interactivo.
                    </p>
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="/products" class="btn btn-primary btn-lg" data-testid="button-view-products">
                            <i class="fas fa-shopping-cart me-2"></i>Ver Productos
                        </a>
                        <% if (isAuthenticated && user.is_admin) { %>
                        <a href="/admin" class="btn btn-outline-primary btn-lg" data-testid="button-admin-dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard Admin
                        </a>
                        <% } else { %>
                        <button class="btn btn-outline-primary btn-lg" onclick="showNotification('Demo interactivo próximamente disponible')" data-testid="button-demo">
                            <i class="fas fa-play me-2"></i>Demo Interactivo
                        </button>
                        <% } %>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&h=600" 
                     alt="Dashboard administrativo moderno con métricas y gráficos" 
                     class="img-fluid rounded-3 shadow-lg"
                     data-testid="img-hero">
            </div>
        </div>
    </div>
</section>

<!-- Active Promotions Section -->
<% if (promotions && promotions.length > 0) { %>
<section class="py-5" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(167, 139, 250, 0.05));">
    <div class="container">
        <div class="row mb-4">
            <div class="col-lg-8 mx-auto text-center">
                <h2 class="font-space-grotesk fw-bold mb-3" style="font-size: 2.5rem;" data-testid="text-promotions-title">
                    Promociones Activas
                </h2>
                <p class="text-muted fs-5" data-testid="text-promotions-subtitle">
                    Aprovecha estas ofertas por tiempo limitado
                </p>
            </div>
        </div>
        
        <div class="row g-4">
            <% promotions.forEach((promotion, index) => { %>
            <div class="col-md-6 col-lg-4">
                <div class="product-card position-relative" data-testid="card-promotion-<%= promotion.id %>">
                    <!-- Promotion Badge -->
                    <div class="position-absolute top-0 start-0 z-index-10">
                        <span class="badge bg-danger m-2" data-testid="badge-discount-<%= promotion.id %>">
                            -<%= promotion.discount_percent %>%
                        </span>
                    </div>
                    
                    <% if (promotion.products && promotion.products.image_url) { %>
                    <img src="<%= promotion.products.image_url %>" alt="<%= promotion.products.name %>" class="product-image">
                    <% } else { %>
                    <div class="product-image bg-light d-flex align-items-center justify-content-center">
                        <i class="fas fa-image fa-3x text-muted"></i>
                    </div>
                    <% } %>
                    
                    <div class="product-info">
                        <h5 class="product-title" data-testid="text-promotion-title-<%= promotion.id %>"><%= promotion.title %></h5>
                        <% if (promotion.products) { %>
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <span class="text-decoration-line-through text-muted" data-testid="text-original-price-<%= promotion.id %>">
                                $<%= parseFloat(promotion.products.price).toLocaleString() %>
                            </span>
                            <div class="product-price" data-testid="text-promo-price-<%= promotion.id %>">
                                $<%= (parseFloat(promotion.products.price) * (1 - promotion.discount_percent / 100)).toLocaleString() %>
                            </div>
                        </div>
                        <p class="product-description" data-testid="text-promotion-product-<%= promotion.id %>">
                            <%= promotion.products.name %>
                        </p>
                        <% } %>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                Válida hasta <%= new Date(promotion.ends_at).toLocaleDateString('es-ES') %>
                            </small>
                            <% if (promotion.products) { %>
                            <a href="/product/<%= promotion.products.id %>" class="btn btn-primary btn-sm" data-testid="button-view-promotion-<%= promotion.id %>">
                                Ver Oferta
                            </a>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
            <% }); %>
        </div>
    </div>
</section>
<% } %>

<!-- Featured Products Section -->
<section id="products" class="py-5">
    <div class="container">
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto text-center">
                <h2 class="font-space-grotesk fw-bold mb-3" style="font-size: 2.5rem;" data-testid="text-featured-title">
                    Productos Destacados
                </h2>
                <p class="text-muted fs-5" data-testid="text-featured-subtitle">
                    Explora nuestra colección minimalista de productos cuidadosamente seleccionados
                </p>
            </div>
        </div>
        
        <div class="row g-4">
            <% if (products && products.length > 0) { %>
                <% products.forEach((product, index) => { %>
                <div class="col-md-6 col-lg-4">
                    <div class="product-card" data-testid="card-product-<%= product.id %>">
                        <% if (product.image_url) { %>
                        <img src="<%= product.image_url %>" alt="<%= product.name %>" class="product-image" data-testid="img-product-<%= product.id %>">
                        <% } else { %>
                        <!-- Fallback images based on category or default -->
                        <% 
                        let fallbackImage = "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400";
                        if (product.category === 'electronics') {
                            const electronicsImages = [
                                "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400", // laptop
                                "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400", // headphones
                                "https://images.unsplash.com/photo-1592750475338-74b7b21085ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400"  // phone
                            ];
                            fallbackImage = electronicsImages[index % electronicsImages.length];
                        }
                        %>
                        <img src="<%= fallbackImage %>" alt="<%= product.name %>" class="product-image" data-testid="img-product-<%= product.id %>">
                        <% } %>
                        
                        <div class="product-info">
                            <h5 class="product-title" data-testid="text-product-name-<%= product.id %>"><%= product.name %></h5>
                            <div class="product-price" data-testid="text-product-price-<%= product.id %>">$<%= parseFloat(product.price).toLocaleString() %></div>
                            <p class="product-description" data-testid="text-product-description-<%= product.id %>">
                                <%= product.description.length > 100 ? product.description.substring(0, 100) + '...' : product.description %>
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-box me-1"></i>
                                    <span data-testid="text-product-stock-<%= product.id %>"><%= product.stock %></span> disponibles
                                </small>
                                <a href="/product/<%= product.id %>" class="btn btn-primary btn-sm" data-testid="button-view-product-<%= product.id %>">
                                    Ver Detalles
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <% }); %>
            <% } else { %>
            <div class="col-12 text-center py-5" data-testid="div-no-products">
                <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                <h3 class="text-muted">No hay productos disponibles</h3>
                <p class="text-muted">Los productos aparecerán aquí cuando estén disponibles.</p>
                <% if (isAuthenticated && user.is_admin) { %>
                <a href="/admin" class="btn btn-primary mt-3">
                    <i class="fas fa-plus me-2"></i>Agregar Productos
                </a>
                <% } %>
            </div>
            <% } %>
        </div>
        
        <% if (products && products.length > 0) { %>
        <div class="text-center mt-5">
            <a href="/products" class="btn btn-outline-primary btn-lg" data-testid="button-view-all-products">
                <i class="fas fa-arrow-right me-2"></i>Ver Todos los Productos
            </a>
        </div>
        <% } %>
    </div>
</section>

<!-- Call to Action Section -->
<section class="py-5" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-light));">
    <div class="container text-center text-white">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h2 class="font-space-grotesk fw-bold mb-3" data-testid="text-cta-title">
                    ¿Listo para comenzar?
                </h2>
                <p class="fs-5 mb-4" data-testid="text-cta-subtitle">
                    Únete a nuestra comunidad y descubre productos increíbles con la mejor experiencia de compra.
                </p>
                <% if (!isAuthenticated) { %>
                <a href="/auth" class="btn btn-light btn-lg" data-testid="button-cta-signup">
                    <i class="fas fa-user-plus me-2"></i>Crear Cuenta Gratis
                </a>
                <% } else { %>
                <a href="/products" class="btn btn-light btn-lg" data-testid="button-cta-shop">
                    <i class="fas fa-shopping-bag me-2"></i>Comenzar a Comprar
                </a>
                <% } %>
            </div>
        </div>
    </div>
</section>
